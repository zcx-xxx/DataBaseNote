# 第十章 数据库恢复技术

## 10.1 事物的额基本概念

**1. 事务**

用户定义的一个是数据库操作序列，这些操作要么全做，要么全不做，是一个不可分割的基本单位，是恢复和并发控制的基本单位。

**2. 定义事务的两种基本方式**

**显示定义事务**

由begin transaction开始，由commit或者rollback结束。

**隐式定义事务**

默认情况下一条SQL语句为一个事务。

> commit：
>
> 手动提交事务，全做。
>
> rollback：
>
> 撤销事务，全不做。

**3. 事务的特性**

见PPT，有可能是简答。

## 10.2 数据库恢复概述

**1. 定义**

保证故障发生后，能把数据库从错误状态恢复到某一已知的正确状态，这就是数据库的恢复

**2. 地位**

恢复技术是衡量系统优劣的重要指标

## 10.3 故障的种类

**1. 事务内部的故障**

**产生原因**

* 程序本身的问题
* 非预期的

> 非预期的：
>
> * 运算溢出
>
> * 并发事务发生死锁而被选中撤销该事务
>
> * 违反了某些完整性限制等

**解决办法**

撤消事务（UNDO）

**2. 系统故障**

**定义**

称为软故障，是指造成系统停止运转的任何事件，使得系统要重新启动

**产生不一致状态的两个原因：**

* 未完成的事务对数据库的更新操作可能已经写入数据库
* 已经完成的事务对数据库的更新可能还在缓冲区，没来及写回数据库

**特征**

* 整个系统的正常运行突然被破坏

* 所有正在运行的事务都非正常终止

* 不破坏数据库

* 内存中数据库缓冲区的信息全部丢失

**解决办法**

* 事务已提交：强行撤消（UNDO）所有未完成事务
* 事务未提交：重做（REDO）所有已提交的事务

**3. 介质故障**

**定义**

称为硬故障，指外存故障

**特征**

- 磁盘损坏

- 磁头碰撞

- 操作系统的某种潜在错误

+ 瞬时强磁场干扰

**解决办法**

数据转储，使用以前的备份，然后将中间做的操作重新做一遍。

**4. 计算机病毒**

**定义**

一种人为的故障或破坏，是一些恶作剧者研制的一种计算机程序

## 10.4 恢复技术的实现

**1. 数据转储的概念**

指DBA将整个数据库复制到磁带或另一个磁盘上保存起来的过程

**2. 四种基本的转储方式及其组合后的四种方式**

见课本P298。